name: PR Test Release
on:
  pull_request:
    branches:
      - main
permissions:
  contents: write
  pull-requests: write
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Checkout temporary branch
        run: |
          git checkout -b release/PR${{ github.event.number }}
      - name: Stamp version into publish action
        run: |
          sed -i s/@main/@PR${{ github.event.number }}/g publish/action.yml
          git config --global user.name "${GITHUB_ACTOR}"
          git config --global user.email "${GITHUB_ACTOR_ID}+${GITHUB_ACTOR}@users.noreply.github.com"
          git commit -am "ðŸ§ª PR${{ github.event.number }}"
      - name: Tag version
        run: |
          git tag PR${{ github.event.number }} --force
      - name: Push tags
        run: |
          git push origin --tags --force
      - name: Comment on PR
        uses: curvenote/actions/upsert-comment@v1
        with:
          comment: |
            You may test this pull request by updating your action:

            ```yaml .github/workflows/publish.yml
            ...
            jobs:
              publish:
                uses: curvenote/actions/publish@PR${{ github.event.number }}'
              with:
                ...
            ```
